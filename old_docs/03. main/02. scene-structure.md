# 씬 구조

> Unity 프로젝트의 씬 구성 및 계층 구조 정의

---

## 씬 목록

| 씬 | 용도 | 상태 |
|----|------|------|
| **BattleScene** | 전투 씬 | 현재 구현 대상 |
| BootScene | 초기화, Addressables 로드 | 향후 추가 |
| TitleScene | 타이틀 화면, 메뉴 | 향후 추가 |

---

## 씬 전환 방식

**하이브리드**: 기본 Single + 필요 시 Additive

- **Single**: 일반적인 씬 전환 (Title → Battle 등)
- **Additive**: UI 오버레이, 팝업 씬 추가 로드

---

## BattleScene 계층 구조

```
BattleScene
└─ SceneRoot
   ├─ BattleSceneController   # ISceneController 구현, 씬 루트
   │
   ├─ EnvironmentRoot         # 배경, 환경 오브젝트
   │   └─ (배경 이미지, 전투 필드 등)
   │
   ├─ BattleUIRoot            # UI Canvas들
   │   ├─ BGCanvas        [Sort: 0]   # 배경 (정적)
   │   ├─ BattleCanvas    [Sort: 10]  # 캐릭터, HP바, 이펙트
   │   ├─ HandCanvas      [Sort: 20]  # 손패, 드래그, 에너지
   │   └─ OverlayCanvas   [Sort: 30]  # 툴팁, 모달, 가이드
   │
   ├─ VFXRoot                 # 이펙트 (ParticleSystem 등)
   │   └─ (피격 이펙트, 카드 사용 이펙트 등)
   │
   └─ DebugRoot (Optional)    # 디버그용 (에디터 전용)
       └─ (디버그 UI, 치트 패널 등)
```

---

## 매니저 패턴

### Service Registry + Composition Root

**원칙:**
- ServiceLocator를 **프로젝트 어디서나 사용하지 않음**
- **Bootstrap/AppRoot에서만** 서비스 등록
- 씬 진입 시 `BattleSceneController`가 필요한 참조를 **명시적으로 주입받음**

**장점:**
- Locator의 편리함 유지
- "숨은 의존성" 최소화
- 테스트 용이성 향상

### 구조 예시

```
AppRoot (DontDestroyOnLoad)
├─ ServiceRegistry            # 서비스 등록/조회
└─ (Global Services)

BattleScene
└─ BattleSceneController      # 씬 진입 시 필요한 서비스 주입받음
   ├─ BattleManager
   ├─ DeckManager
   └─ UIManager
```

---

## Canvas 아키텍처

### 계층 구조

| Canvas | Sort Order | 역할 | 변경 빈도 |
|--------|------------|------|----------|
| BGCanvas | 0 | 배경 이미지 | 거의 없음 (정적) |
| BattleCanvas | 10 | 캐릭터, HP바, 피격 플래시 | 중간 |
| HandCanvas | 20 | 손패, 드래그, 에너지/덱 | 높음 (최중요) |
| OverlayCanvas | 30 | 툴팁, 모달, 가이드 | 이벤트성 |

### Canvas 설정 (공통)

```
모든 Canvas
├── Render Mode: Screen Space - Overlay
├── Pixel Perfect: false (성능)
└── Additional Shader Channels: Nothing

Canvas Scaler
├── UI Scale Mode: Scale With Screen Size
├── Reference Resolution: 1920 x 1080
├── Screen Match Mode: Match Width Or Height
└── Match: 0.5
```

### 드로우콜 최적화

| Canvas | 전략 |
|--------|------|
| BGCanvas | Static Batching (변경 없음) |
| BattleCanvas | Sprite Atlas 사용 |
| HandCanvas | 카드별 Material 공유 |
| OverlayCanvas | 필요 시에만 활성화 |

---

## ISceneController 인터페이스

```csharp
public interface ISceneController
{
    void Initialize(/* 필요한 서비스 주입 */);
    void OnSceneEnter();
    void OnSceneExit();
}
```

---

## 관련 문서

| 문서 | 설명 |
|------|------|
| [00. coding-convention.md](./00.%20coding-convention.md) | C# 코딩 컨벤션 |
| [01. folder-structure.md](./01.%20folder-structure.md) | 폴더 구조 |
| [unity-project-architecture.md](./unity-project-architecture.md) | 전체 프로젝트 아키텍처 |
