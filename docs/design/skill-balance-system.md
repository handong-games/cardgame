# 스킬 밸런스 시스템

이 문서는 스킬의 밸런스 계산 공식, 코스트별 기준 범위, 설계 원칙을 정의합니다.

---

## 1. 밸류(Value) 시스템 개요

### 1.1 핵심 원칙

**"모든 스킬은 코스트에 비례하는 밸류를 제공해야 한다"**

- 밸류(Value)는 스킬의 총 효용을 수치화한 것
- 동일 코스트의 스킬은 비슷한 밸류를 가져야 균형 유지
- 밸류는 즉시 효과 + 조건부 효과 + 제약 보정으로 계산

### 1.2 밸류 계산 공식

```
총 밸류 = 기본 효과 밸류 × 제약 조건 보정
```

여기서:
- **기본 효과 밸류** = Σ(효과량 × 효과별 가중치)
- **제약 조건 보정** = Π(제약별 승수)

---

## 2. 효과별 가중치

각 효과 유형은 고유한 가중치를 가집니다.

| 효과 유형 | 가중치 | 설명 |
|----------|--------|------|
| **데미지 (damage)** | 1.0 | 기준 효과, 즉시 적에게 피해 |
| **방어 (block)** | 1.0 | 기준 효과, 즉시 방어력 획득 |
| **힐 (heal)** | 1.4 | 안정성 패널티 (+40%), 누적 가능한 자원 |
| **버프 스택 (buff_stack)** | 3.0 | 지속 효과 가치, 턴을 걸쳐 효용 |
| **코인 획득 (coin_gain)** | 1.0 | 간접적 가치, 행동 가능성 증가 |

### 2.1 자해 데미지 패널티

| 효과 | 패널티 승수 | 설명 |
|------|-----------|------|
| **자해 데미지 (self damage)** | -1.5 | 자해 1당 밸류 -1.5 감소 |

**예시:** 자해 4 데미지 = -6 밸류 (4 × 1.5)

---

## 3. 코스트별 기준 범위

스킬의 코인 코스트에 따른 허용 밸류 범위:

| 코스트 | 최소 밸류 | 최대 밸류 | 평균 | 설명 |
|--------|----------|----------|------|------|
| **1코인** | 5 | 6 | 5.5 | 기본 행동, 단순 효과 |
| **2코인** | 10 | 14 | 12 | 주력 스킬, 복합 효과 |
| **3코인** | 15 | 18 | 16.5 | 필살기급, 강력한 효과 |

### 3.1 밸런스 판정 기준

```
✅ OK:     밸류가 기준 범위 내
⚠️ WARNING: 밸류가 기준 범위 초과 (최대 +20%)
❌ FAIL:    밸류가 기준 범위 크게 초과 (+20% 이상)
```

---

## 4. 제약 조건 보정

사용 제한이 있는 스킬은 더 강한 효과를 가질 수 있습니다.

### 4.1 턴당 사용 제한

| 제약 | 보정 승수 | 설명 |
|------|----------|------|
| **턴당 1회** | ×1.20 | 밸류 +20% |
| **턴당 2회** | ×1.10 | 밸류 +10% |

### 4.2 쿨다운 제한

| 제약 | 보정 승수 | 설명 |
|------|----------|------|
| **쿨다운 2턴** | ×1.15 | 밸류 +15% |
| **쿨다운 3턴** | ×1.25 | 밸류 +25% |

### 4.3 복합 제약 계산

제약이 여러 개일 경우 곱연산:

```
예시: 턴당 1회 + 쿨다운 2턴
보정 = 1.20 × 1.15 = 1.38 (+38%)
```

---

## 5. 조건부 효과 증폭

발동 조건이 있는 효과는 더 강한 수치를 가질 수 있습니다.

| 조건 유형 | 증폭 승수 | 난이도 | 예시 |
|----------|----------|--------|------|
| **HP 조건** | ×1.50 | 어려움 | "HP 30% 이하 시" |
| **적 상태 조건** | ×1.40 | 중간 | "적이 출혈 상태 시" |
| **버프 조건** | ×1.30 | 쉬움 | "분노 스택 3 이상 시" |
| **코인 조건** | ×1.20 | 가장 쉬움 | "앞면이 2개 이상 시" |

### 5.1 조건부 효과 밸류 계산

```
조건부 밸류 = 기본 효과 × 조건 증폭 승수 × 발동 확률
```

**예시:** 앞면 시 +6 데미지
- 기본: 6 밸류
- 발동 확률: 50% (기본 코인 확률)
- 코인 조건 증폭: ×1.20
- 최종 기대 밸류: 6 × 0.5 × 1.20 = 3.6

---

## 6. 밸류 계산 예시

### 예시 1: 기본 공격 (1코인)

```
스킬: 강타
코스트: 1코인
효과: 데미지 6

계산:
- 기본 밸류: 6 × 1.0 = 6
- 제약 보정: 없음 (×1.0)
- 총 밸류: 6

판정: ✅ OK (기준 5~6)
```

### 예시 2: 방어 스킬 (1코인)

```
스킬: 방어
코스트: 1코인
효과: 방어 5

계산:
- 기본 밸류: 5 × 1.0 = 5
- 제약 보정: 없음 (×1.0)
- 총 밸류: 5

판정: ✅ OK (기준 5~6)
```

### 예시 3: 강화 공격 (2코인, 턴당 1회)

```
스킬: 분노의 일격
코스트: 2코인
효과: 데미지 10
제약: 턴당 1회

계산:
- 기본 밸류: 10 × 1.0 = 10
- 제약 보정: ×1.20 (턴당 1회)
- 총 밸류: 10 × 1.20 = 12

판정: ✅ OK (기준 10~14)
```

### 예시 4: 버서커 스킬 (3코인, 자해 포함)

```
스킬: 광기의 일격
코스트: 3코인
효과: 데미지 15, 자해 3

계산:
- 데미지 밸류: 15 × 1.0 = 15
- 자해 패널티: 3 × 1.5 = -4.5
- 기본 밸류: 15 - 4.5 = 10.5
- 총 밸류: 10.5

판정: ⚠️ WARNING (기준 15~18, 실제 10.5로 약함)
→ 데미지 상향 필요
```

---

## 7. 스킬 설계 원칙

### 7.1 등가 교환 원칙

> "모든 선택에는 대가가 있어야 한다"

- 강한 효과 → 제약 조건 필요
- 안정적 효과 → 폭발력 낮음
- 조건부 효과 → 발동 불확실성

### 7.2 선택의 다양성 원칙

> "모든 스킬이 상황에 따라 최선이 될 수 있어야 한다"

- 항상 최선인 스킬 ❌
- 절대 선택 안 하는 스킬 ❌
- 상황별 최적 스킬 ✅

### 7.3 클래스 정체성 원칙

> "각 클래스는 특정 코인 결과에서 강점을 발휘해야 한다"

| 클래스 | 특화 | 스킬 설계 방향 |
|--------|------|---------------|
| 전사 | 앞면 | 앞면 시 보너스, 안정적 |
| 도적 | 뒷면 | 뒷면 시 보너스, 폭발적 |
| 마법사 | 양면 | 조건부 다양성, 원소 시너지 |

---

## 8. 밸런스 검증 체크리스트

### 신규 스킬 추가 시

- [ ] 코스트 대비 밸류가 기준 범위 내인가?
- [ ] 조건부 효과의 발동 확률을 고려했는가?
- [ ] 제약 조건이 적절히 보정에 반영되었는가?
- [ ] 클래스 정체성과 일치하는가?
- [ ] 기존 스킬과 비교해 상위/하위 호환이 아닌가?

### 밸런스 조정 시

- [ ] 수치 변경 후 밸류 재계산했는가?
- [ ] 연관된 시너지/콤보 영향을 검토했는가?
- [ ] 플레이테스트로 체감 밸런스를 확인했는가?

---

## 9. 구현 참조

### 9.1 상수 파일

```typescript
// dev/proto/src/data/skills/balance-values.ts
export const BALANCE_VALUES = {
  damage: 1.0,
  block: 1.0,
  heal: 1.4,
  buff_stack: 3.0,
  self_damage_penalty: 1.5,

  cost1: { min: 5, max: 6 },
  cost2: { min: 10, max: 14 },
  cost3: { min: 15, max: 18 },

  maxUse1: 1.20,
  maxUse2: 1.10,
  cooldown2: 1.15,
  cooldown3: 1.25,

  conditional_hp: 1.50,
  conditional_enemy: 1.40,
  conditional_buff: 1.30,
  conditional_coin: 1.20,
};
```

### 9.2 유틸리티 함수

- `calculateBaseValue()`: 기본 효과 밸류 계산
- `calculateConstraintBonus()`: 제약 조건 보정 계산
- `calculateTotalValue()`: 총 밸류 계산

---

## 관련 문서

- [클래스 설계 가이드](./class-design.md)
- [밸런스 설계 가이드](./balance-design.md)
- [스킬 생성 워크플로우](../00.%20claude/skill-creation-workflow.md)
