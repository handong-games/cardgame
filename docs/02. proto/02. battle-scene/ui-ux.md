# 배틀씬 UI/UX

> 배틀씬 인터랙션 및 UI 동작 정의

---

## 관련 문서

| 문서 | 설명 |
|------|------|
| [screen.md](./screen.md) | 화면 레이아웃 및 컴포넌트 정의 |
| [animation.md](./animation.md) | 카드 및 전투 애니메이션 정의 |

---

## 카드 인터랙션

### 드래그 앤 드롭

카드를 드래그하여 사용하는 인터랙션

| 카드 타입 | 유효한 드롭 영역 |
|----------|-----------------|
| 공격 카드 | 적 캐릭터 영역 |
| 스킬/파워 카드 | 전투 필드 또는 적 영역 |

### 드래그 시 시각적 피드백

| 상태 | 표시 |
|------|------|
| 드래그 중 | 원본 카드 반투명 + 드래그 오버레이 표시 |
| 유효 드롭 영역 | 초록색 테두리 하이라이트 |
| 무효 드롭 영역 | 빨간색 테두리 하이라이트 |

### 카드 비활성화 조건

- 에너지 부족 (카드 비용 > 현재 에너지)
- 애니메이션 진행 중
- 플레이어 턴이 아님

### 데미지 프리뷰

공격 카드 드래그 중 적 영역에 호버하면 예상 데미지를 미리 표시합니다.

#### 활성화 조건

- 공격 카드 드래그 중
- 적 영역에 호버

#### 표시 방식

```
         -8          ← 데미지 숫자 (orange-400)
┌──────────────────────────┐
│███████████████░░░░░░░░░░ │
└──────────────────────────┘
         ↑ 기존 HP  ↑ 프리뷰 (주황색 깜빡임)
```

| 요소 | 설명 |
|------|------|
| HP 바 프리뷰 | 예상 감소량을 주황색으로 표시 (깜빡임 효과) |
| 데미지 숫자 | HP 바 위에 "-8" 형태로 표시 |

#### 데미지 계산

- 적 방어력을 고려한 실제 HP 데미지만 표시
- `실제 데미지 = max(0, 카드 데미지 - 적 방어력)`

---

## 손패 배열

### 부채꼴 배열

손패의 카드는 부채꼴 형태로 배열됩니다.

```
        ┌────┐
       ╱      ╲
    ┌────┐  ┌────┐
   ╱      ╲╱      ╲
┌────┐          ┌────┐
```

| 속성 | 계산 |
|------|------|
| 회전 | `(index - middle) × 5도` |
| Y 오프셋 | `|index - middle| × 10px` |

### 호버 효과

카드에 마우스를 올렸을 때:
- 스케일: 1.05배
- Y 이동: -32px (위로 올라감)
- 회전: 0도 (원래 회전 초기화)
- Z-index: 최상위

---

## 턴 시스템

### 턴 진행 흐름

```
[플레이어 턴]
    ↓ 턴 종료 클릭
[카드 버림 애니메이션]
    ↓ 완료
[적 턴 - 적 행동 실행]
    ↓ 완료
[카드 드로우 애니메이션]
    ↓ 완료
[플레이어 턴]
```

### 턴 시작 시 처리

1. 에너지 최대치로 회복
2. 플레이어 방어력 0으로 리셋
3. 버프 지속시간 감소
4. 카드 5장 드로우

---

## 에너지 시스템

| 상태 | 표시 |
|------|------|
| 기본 | 현재/최대 (예: 3/3) |
| 색상 | 노란색 (yellow-500) |
| 위치 | 하단 UI 좌상단 |

---

## 버프 표시

활성 버프는 캐릭터 카드 아래에 표시됩니다.

| 요소 | 설명 |
|------|------|
| 아이콘 | 버프별 이모지 |
| 스택 수 | 우하단 숫자 뱃지 |
| 지속시간 | 턴 수 표시 (combat = 무한) |

---

## 상태별 화면 전환

| 현재 상태 | 조건 | 다음 상태 |
|----------|------|----------|
| `player_turn` | 턴 종료 | `enemy_turn` |
| `enemy_turn` | 적 행동 완료 | `player_turn` |
| `player_turn` | 적 HP ≤ 0 | `reward` |
| `enemy_turn` | 플레이어 HP ≤ 0 | `defeat` |
| `reward` | 카드 선택/스킵 | `class_advancement` 또는 `victory` |
| `class_advancement` | 전직 완료 | `victory` |
