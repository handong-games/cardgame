# 배틀씬 애니메이션

> 카드 및 전투 애니메이션 정의

---

## 애니메이션 페이즈

카드 애니메이션은 3가지 페이즈로 관리됩니다.

| 페이즈 | 설명 | 트리거 |
|--------|------|--------|
| `idle` | 대기 상태, 플레이어 입력 가능 | 애니메이션 완료 시 |
| `discarding` | 손패 → 버림패 애니메이션 진행 중 | 턴 종료 버튼 클릭 |
| `drawing` | 덱 → 손패 애니메이션 진행 중 | 새 턴 시작 |

### 페이즈 전환 흐름

```
[idle] → 턴 종료 클릭 → [discarding] → 완료 → 적 턴 → [drawing] → 완료 → [idle]
```

### 입력 제한

애니메이션 진행 중(`discarding`, `drawing`)에는:
- 카드 플레이 비활성화
- 턴 종료 버튼 비활성화
- 드래그 앤 드롭 비활성화

---

## 카드 애니메이션 타이밍

| 상수 | 값 | 설명 |
|------|-----|------|
| `CARD_STAGGER` | 0.08초 | 카드 간 애니메이션 딜레이 |
| `DISCARD_DURATION` | 0.3초 | 버림 애니메이션 시간 |
| `DRAW_DURATION` | 0.2초 | 드로우 애니메이션 시간 |

### 전체 애니메이션 시간 계산

```
버림 시간 = DISCARD_DURATION + (손패 수 × CARD_STAGGER)
드로우 시간 = DRAW_DURATION + (드로우 수 × CARD_STAGGER)
```

---

## 버림 애니메이션 (Discard)

턴 종료 시 손패의 모든 카드가 버림패로 이동하는 애니메이션

### 옵션 A: 오른쪽으로 날아감 (기본)

```
시작 위치: 손패 위치
종료 위치: x +300, y -50
회전: +15도
투명도: 0
이징: easeIn
```

```
      ┌────┐
      │카드│ ──→  (오른쪽 위로 날아감)
      └────┘
```

### 옵션 B: 아래로 떨어짐

```
시작 위치: 손패 위치
종료 위치: x +50, y +200
회전: +25도
투명도: 0
이징: easeIn
```

```
      ┌────┐
      │카드│
      └────┘
         ↓  (아래로 떨어짐)
```

### 옵션 C: 위로 날아감

```
시작 위치: 손패 위치
종료 위치: x 0, y -200
회전: -10도
스케일: 0.5
투명도: 0
이징: easeOut
```

```
         ↑  (위로 사라짐)
      ┌────┐
      │카드│
      └────┘
```

---

## 드로우 애니메이션 (Draw)

새 턴 시작 시 덱에서 손패로 카드가 이동하는 애니메이션

### 옵션 A: 덱에서 날아옴 (기본)

```
시작 위치: x -250 (덱 위치), y +150
시작 회전: -15도
시작 스케일: 0.8
시작 투명도: 0

종료 위치: 손패 위치 (x 0, y 0)
종료 회전: 0도
종료 스케일: 1
종료 투명도: 1
이징: spring (stiffness: 300, damping: 25)
```

```
  ○ 덱
    ↘
       ┌────┐
       │카드│  (손패 위치로)
       └────┘
```

### 옵션 B: 위에서 떨어짐

```
시작 위치: x 0, y -200
시작 스케일: 0.9
시작 투명도: 0

종료 위치: 손패 위치
이징: spring
```

```
         ↓
      ┌────┐
      │카드│
      └────┘
```

### 옵션 C: 중앙에서 팝업

```
시작 위치: 손패 위치
시작 스케일: 0
시작 투명도: 0

종료 스케일: 1
종료 투명도: 1
이징: spring
```

```
      ┌────┐
      │ ◎ │ → 확대되며 등장
      └────┘
```

---

## 손패 상태 (In Hand)

카드가 손패에 있을 때의 기본 상태

```
위치: x 0, y 0
스케일: 1
투명도: 1
회전: 부채꼴 배열에 따른 값
```

---

## 전투 애니메이션 (Combat)

캐릭터 공격 및 피격 시 재생되는 애니메이션

### 전투 애니메이션 타이밍

| 상수 | 값 | 설명 |
|------|-----|------|
| `PEEK_DURATION` | 0.1초 | 뒤로 빠지는 시간 |
| `HIT_DURATION` | 0.15초 | 앞으로 치는 시간 |
| `RETURN_DURATION` | 0.15초 | 원위치 복귀 시간 |
| `SHAKE_DURATION` | 0.3초 | 피격 흔들림 시간 |
| `SHIELD_SHAKE` | 0.2초 | 방패 흔들림 시간 |

### Peek & Hit (공격자)

공격 시 살짝 뒤로 빠졌다가 앞으로 치고 원위치로 돌아오는 애니메이션

```
유저 공격 (오른쪽 방향):
  x: 0 → -20 → +30 → 0

적 공격 (왼쪽 방향):
  x: 0 → +20 → -30 → 0
```

```
타이밍 (총 0.4초):
  [0%]─────[25%]─────[60%]─────[100%]
   ↓         ↓         ↓         ↓
  시작     Peek      Hit      원위치
         (뒤로)   (앞으로)
```

### Hit React (피격자)

공격을 받을 때 좌우로 흔들리는 애니메이션

```
x: 0 → -10 → +10 → -5 → 0
```

**중요**: 피격 애니메이션은 공격자가 "Hit" 지점에 도달할 때 시작
- 딜레이: `PEEK_DURATION + HIT_DURATION` = 0.25초

```
타이밍 순서:
  [공격자] Peek ──→ Hit ──→ Return
                     ↓
  [피격자]          흔들림 시작
```

### 방패 피드백

방어력이 감소할 때 방패 아이콘과 숫자에 적용되는 애니메이션

#### 방패 흔들림
```
rotate: 0 → -15 → +15 → -10 → 0
scale: 1 → 1.1 → 1
```

#### 숫자 강조
```
scale: 1 → 1.3 → 1
```

**타이밍**: 피격 애니메이션과 동일 (0.25초 딜레이 후 시작)

### 전투 애니메이션 상태

| 상태 | 설명 |
|------|------|
| `playerAttacking` | 유저가 공격 중 |
| `enemyAttacking` | 적이 공격 중 |
| `playerHit` | 유저가 피격됨 |
| `enemyHit` | 적이 피격됨 |
| `shieldHit` | 방패가 타격됨 (방어력 감소) |

---

## 몬스터 사망 애니메이션 (Enemy Death)

몬스터 HP가 0이 되면 재생되는 사망 애니메이션

### 타이밍

| 상수 | 값 | 설명 |
|------|-----|------|
| `DEATH_ANIMATION_DURATION` | 0.5초 | 사망 애니메이션 총 시간 |

### 애니메이션 속성

```
opacity: 1 → 0
scale: 1 → 0.5
y: 0 → -30
이징: easeOut
```

```
      ┌────┐
      │적  │ ↗ (위로 축소되며 사라짐)
      └────┘
```

### 사망 흐름

```
[적 HP ≤ 0 감지]
       ↓
[사망 애니메이션 시작] ─── 0.5초 ───→ [보상 화면]
       ↓
   [70% 시점]
       ↓
[골드 드랍 애니메이션 시작]
```

---

## 골드 드랍 애니메이션 (Gold Drop)

몬스터 처치 시 동전이 흩뿌려지는 애니메이션

### 트리거 타이밍

- 사망 애니메이션 **70% 시점** (0.35초)에 시작
- 사망 애니메이션과 자연스럽게 오버랩

### 동전 개수 (획득량 기준)

| 획득 골드 | 동전 개수 |
|----------|:--------:|
| 10~20 G | 3개 |
| 21~40 G | 4개 |
| 41+ G | 5개 |

### 각 동전 애니메이션

```
시작: 몬스터 위치 (중앙)
  - opacity: 0
  - scale: 0

중간 (30%):
  - opacity: 1
  - scale: 1.2
  - y: -40 (위로 튀어오름)
  - x: 랜덤 (-50 ~ +50)

최종 (100%):
  - opacity: 0
  - scale: 0.5
  - y: +50~80 (아래로 낙하)

총 시간: 0.8초
이징: easeOut
```

```
           🪙
        🪙    🪙
      🪙   👾   🪙    (몬스터 위치에서 흩뿌려짐)
           ↓↓↓
        (낙하하며 사라짐)
```

### 골드 텍스트 애니메이션

동전과 함께 "+N" 텍스트가 표시됨

```
시작:
  - opacity: 0
  - scale: 0.5
  - y: +20

중간 (20%):
  - opacity: 1
  - scale: 1.3

종료:
  - opacity: 0
  - scale: 0.8
  - y: -50

총 시간: 1초
```

### 상단 바 골드 펄스

골드 드랍 완료 후 상단 바의 골드 표시에 펄스 효과

```
scale: 1 → 1.2 → 1
시간: 0.3초
```

---

## 애니메이션 교체 방법

애니메이션은 독립적인 설정 파일로 분리되어 쉽게 교체 가능합니다.

### 설정 구조

```
animations/
├── cardAnimations.ts     # 카드 드로우/버림 애니메이션
├── combatAnimations.ts   # 전투 애니메이션
└── index.ts              # 현재 사용할 애니메이션 export
```

### 교체 예시

```
현재 설정:
  discard: discardFlyRight (A 옵션)
  draw: drawFromDeck (A 옵션)

B 옵션으로 변경:
  discard: discardFallDown (B 옵션)
  draw: drawFromTop (B 옵션)
```

---

## 플랫폼별 구현

### Proto (React + Framer Motion)

| 기능 | 구현 방법 |
|------|----------|
| Exit 애니메이션 | `AnimatePresence` |
| 애니메이션 컴포넌트 | `motion.div` |
| 상태별 정의 | `variants` |
| 물리 기반 이징 | `spring` |
| 명령형 애니메이션 | `useAnimationControls` |

### Main (Unity)

| 기능 | 구현 방법 |
|------|----------|
| 트윈 애니메이션 | `DOTween` 또는 `LeanTween` |
| 순차 애니메이션 | `Sequence` |
| 커스텀 이징 | `AnimationCurve` |
| 투명도 제어 | `CanvasGroup.alpha` |

---

## 참조 파일

| 플랫폼 | 파일 경로 | 설명 |
|--------|----------|------|
| Proto | `dev/proto/src/animations/cardAnimations.ts` | 카드 드로우/버림 애니메이션 |
| Proto | `dev/proto/src/animations/combatAnimations.ts` | 전투 애니메이션 (Peek & Hit, 피격, 사망) |
| Proto | `dev/proto/src/stores/gameStore.ts` | 애니메이션 상태 관리 |
| Proto | `dev/proto/src/components/battle/CharacterCard.tsx` | 유저 캐릭터 애니메이션 적용 |
| Proto | `dev/proto/src/components/battle/EnemyCard.tsx` | 적 캐릭터 애니메이션 적용 |
| Proto | `dev/proto/src/components/effects/GoldDrop.tsx` | 골드 드랍 애니메이션 |
| Proto | `dev/proto/src/components/ui/TopBar.tsx` | 상단 바 (골드 펄스) |
| Main | TBD | - |
